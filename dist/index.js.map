{"version":3,"sources":["../src/services/emailAutomationService.ts","../src/services/emailService.ts","../src/services/emailTemplateManager.ts","../src/templates/emailFormat.ts","../src/providers/resend.ts","../src/providers/errors.ts","../src/templates/shouldEmail.ts","../src/index.ts"],"sourcesContent":["import { Service, ServiceType, IAgentRuntime, elizaLogger, Memory, ModelClass, generateText, composeContext } from \"@elizaos/core\";\nimport { EmailService } from \"./emailService\";\nimport { EmailContext, EmailOptions, GeneratedEmailContent } from \"../types\";\nimport { shouldEmailTemplate } from \"../templates/shouldEmail\";\nimport { emailFormatTemplate } from \"../templates/emailFormat\";\n\nexport class EmailAutomationService extends Service {\n    static get serviceType(): ServiceType {\n        return ServiceType.EMAIL_AUTOMATION;\n    }\n\n    get serviceType(): ServiceType {\n        return ServiceType.EMAIL_AUTOMATION;\n    }\n\n    private emailService!: EmailService;\n    private runtime!: IAgentRuntime;\n\n    constructor() {\n        super();\n    }\n\n    async initialize(runtime: IAgentRuntime): Promise<void> {\n        this.runtime = runtime;\n\n        // Check if enabled\n        const isEnabled = runtime.getSetting('EMAIL_AUTOMATION_ENABLED')?.toLowerCase() === 'true' || false;\n        elizaLogger.debug(`üìã Email Automation Enabled: ${isEnabled}`);\n\n        if (!isEnabled) {\n            elizaLogger.debug(\"‚ùå Email automation is disabled\");\n            return;\n        }\n\n        elizaLogger.info(\"üîÑ Initializing Email Automation Service...\");\n\n        try {\n            // Required settings\n            const resendApiKey = runtime.getSetting('RESEND_API_KEY');\n            const defaultToEmail = runtime.getSetting('DEFAULT_TO_EMAIL');\n            const defaultFromEmail = runtime.getSetting('DEFAULT_FROM_EMAIL');\n\n            elizaLogger.debug(\"üîë Checking configuration:\", {\n                hasApiKey: !!resendApiKey,\n                hasToEmail: !!defaultToEmail,\n                hasFromEmail: !!defaultFromEmail\n            });\n\n            if (!resendApiKey || !defaultToEmail || !defaultFromEmail) {\n                throw new Error('Missing required email configuration: RESEND_API_KEY, DEFAULT_TO_EMAIL, DEFAULT_FROM_EMAIL');\n            }\n\n            this.emailService = new EmailService({\n                RESEND_API_KEY: resendApiKey,\n                OWNER_EMAIL: defaultToEmail\n            });\n\n            elizaLogger.success(`‚úÖ Service ${this.serviceType} initialized successfully`);\n            elizaLogger.info(\"üìß Email service ready to process messages\");\n        } catch (error) {\n            elizaLogger.error(\"‚ùå Failed to initialize email service:\", error);\n            // Don't rethrow - let the service gracefully handle missing config\n        }\n    }\n\n    private async buildContext(memory: Memory): Promise<EmailContext> {\n        elizaLogger.debug(\"üîÑ Building email context for message:\", {\n            userId: memory.userId,\n            messageId: memory.id,\n            contentLength: memory.content.text.length\n        });\n\n        const state = await this.runtime.composeState(memory);\n\n        // Include message content in state for template access\n        if (state) {\n            state.message = {\n                content: memory.content,\n                userId: memory.userId,\n                id: memory.id\n            };\n        }\n\n        return {\n            memory,\n            state,\n            metadata: state?.metadata as Record<string, unknown>,\n            timestamp: new Date(),\n            conversationId: memory.id || ''\n        };\n    }\n\n    async evaluateMessage(memory: Memory): Promise<boolean> {\n        if (!this.emailService) {\n            elizaLogger.error(\"‚ùå Email service not initialized\");\n            throw new Error('Missing required email configuration');\n        }\n\n        try {\n            // Build context first\n            const context = await this.buildContext(memory);\n            elizaLogger.info(\"üîç Evaluating accumulated conversation for email automation:\", {\n                text: memory.content.text,\n                userId: memory.userId,\n                roomId: memory.roomId\n            });\n\n            // Check if we should send an email\n            const shouldEmail = await this.shouldSendEmail(context);\n\n            if (shouldEmail) {\n                elizaLogger.info(\"‚ú® Accumulated context triggered email automation, preparing to send...\");\n                await this.handleEmailTrigger(context);\n                elizaLogger.success(\"‚úÖ Email processed and sent successfully\");\n                return true;\n            }\n\n            elizaLogger.info(\"‚è≠Ô∏è Current context does not warrant email automation\");\n            return false;\n\n        } catch (error) {\n            elizaLogger.error(\"‚ùå Error evaluating message for email:\", error);\n            return false;\n        }\n    }\n\n    private async shouldSendEmail(context: EmailContext): Promise<boolean> {\n        elizaLogger.info(\"ü§î Evaluating if message should trigger email...\");\n        const customPrompt = this.runtime.getSetting('EMAIL_EVALUATION_PROMPT');\n        const template = customPrompt || shouldEmailTemplate;\n\n        elizaLogger.debug(\"üìù Using template:\", {\n            isCustom: !!customPrompt,\n            templateLength: template.length\n        });\n\n        const decision = await generateText({\n            runtime: this.runtime,\n            context: composeContext({\n                state: context.state,\n                template\n            }),\n            modelClass: ModelClass.SMALL\n        });\n\n        elizaLogger.info(\"üìù Final composed prompt:\", {\n            prompt: composeContext({\n                state: context.state,\n                template\n            })\n        });\n\n        const shouldEmail = decision.includes(\"[EMAIL]\");\n        elizaLogger.info(`üìä Email decision: ${shouldEmail ? \"‚úÖ Should send\" : \"‚ùå Should not send\"}`, {\n            decision: decision.trim(),\n            trigger: shouldEmail\n        });\n\n        return shouldEmail;\n    }\n\n    private async handleEmailTrigger(context: EmailContext) {\n        try {\n            // Extract user info and format Discord ID if present\n            const userInfo = {\n                id: context.memory.userId,\n                displayName: this.formatUserIdentifier(context.memory.userId),\n                platform: this.detectPlatform(context.memory.userId),\n                metadata: context.metadata || {}\n            };\n\n            // Parse message content for relevant details\n            const messageText = context.memory.content.text;\n            const enhancedContext = {\n                ...context.state,\n                userInfo,\n                platform: userInfo.platform,\n                originalMessage: messageText,\n                // Let the LLM extract and structure the details from the original message\n                // rather than hardcoding values\n                messageContent: messageText\n            };\n\n            // Generate content with enhanced context\n            const formattedEmail = await generateText({\n                runtime: this.runtime,\n                context: composeContext({\n                    state: enhancedContext,\n                    template: emailFormatTemplate\n                }),\n                modelClass: ModelClass.SMALL\n            });\n\n            // Parse and validate sections\n            const sections = this.parseFormattedEmail(formattedEmail);\n\n            // Add explicit validation with helpful errors\n            if (!sections.background) {\n                elizaLogger.error(\"Missing background section in generated email\");\n                throw new Error(\"Email generation failed: Missing background section\");\n            }\n\n            if (!sections.keyPoints || sections.keyPoints.length === 0) {\n                elizaLogger.error(\"Missing or empty key points in generated email\");\n                throw new Error(\"Email generation failed: No key points generated\");\n            }\n\n            // If validation passes, create email content\n            const emailContent: GeneratedEmailContent = {\n                subject: sections.subject,\n                blocks: [\n                    {\n                        type: 'paragraph',\n                        content: sections.background,\n                        metadata: {\n                            style: 'margin-bottom: 1.5em;'\n                        }\n                    },\n                    {\n                        type: 'heading',\n                        content: 'Key Points'\n                    },\n                    {\n                        type: 'bulletList',\n                        content: sections.keyPoints\n                    }\n                ],\n                metadata: {\n                    tone: 'professional',\n                    intent: 'connection_request',\n                    priority: 'high'\n                }\n            };\n\n            // Add optional technical details if present\n            if (sections.technicalDetails?.length) {\n                emailContent.blocks.push(\n                    {\n                        type: 'heading',\n                        content: 'Technical Details'\n                    },\n                    {\n                        type: 'bulletList',\n                        content: sections.technicalDetails\n                    }\n                );\n            }\n\n            // Add next steps if present\n            if (sections.nextSteps?.length) {\n                emailContent.blocks.push(\n                    {\n                        type: 'heading',\n                        content: 'Next Steps'\n                    },\n                    {\n                        type: 'bulletList',\n                        content: sections.nextSteps\n                    }\n                );\n            }\n\n            elizaLogger.info(\"üìã Email content prepared:\", {\n                subject: emailContent.subject,\n                blocksCount: emailContent.blocks.length,\n                metadata: emailContent.metadata\n            });\n\n            const emailOptions = {\n                to: this.runtime.getSetting('DEFAULT_TO_EMAIL') || '',\n                from: this.runtime.getSetting('DEFAULT_FROM_EMAIL') || '',\n                headers: {\n                    'X-Conversation-ID': context.conversationId,\n                    'X-User-ID': userInfo.id,\n                    'X-Platform': userInfo.platform,\n                    'X-Display-Name': userInfo.displayName\n                }\n            };\n\n            elizaLogger.info(\"üì§ Composing email...\", {\n                to: emailOptions.to,\n                from: emailOptions.from,\n                conversationId: context.conversationId\n            });\n\n            await this.emailService.sendEmail(emailContent, emailOptions);\n        } catch (error) {\n            elizaLogger.error(\"‚ùå Email generation failed:\", { error, context });\n            throw error;\n        }\n    }\n\n    private parseFormattedEmail(formattedEmail: string): {\n        subject: string;\n        background: string;\n        keyPoints: string[];\n        technicalDetails?: string[];\n        nextSteps: string[];\n    } {\n        const sections: any = {};\n\n        try {\n            // Extract subject\n            const subjectMatch = formattedEmail.match(/Subject: (.+?)(?:\\n|$)/);\n            sections.subject = subjectMatch?.[1]?.trim() || 'New Connection Request';\n            elizaLogger.debug(\"üìù Parsed subject:\", sections.subject);\n\n            // Extract background\n            const backgroundMatch = formattedEmail.match(/Background:\\n([\\s\\S]*?)(?=\\n\\n|Key Points:|$)/);\n            sections.background = backgroundMatch?.[1]?.trim() || '';\n            elizaLogger.debug(\"üìù Parsed background:\", {\n                found: !!backgroundMatch,\n                length: sections.background.length\n            });\n\n            // Extract key points\n            const keyPointsMatch = formattedEmail.match(/Key Points:\\n([\\s\\S]*?)(?=\\n\\n|Technical Details:|Next Steps:|$)/);\n            sections.keyPoints = keyPointsMatch?.[1]\n                ?.split('\\n')\n                .filter(point => point.trim())\n                .map(point => point.trim().replace(/^[‚Ä¢\\-]\\s*/, '')) || [];\n            elizaLogger.debug(\"üìù Parsed key points:\", {\n                count: sections.keyPoints.length,\n                points: sections.keyPoints\n            });\n\n            // Extract technical details (optional)\n            const technicalMatch = formattedEmail.match(/Technical Details:\\n([\\s\\S]*?)(?=\\n\\n|Next Steps:|$)/);\n            if (technicalMatch) {\n                sections.technicalDetails = technicalMatch[1]\n                    ?.split('\\n')\n                    .filter(point => point.trim())\n                    .map(point => point.trim().replace(/^[‚Ä¢\\-]\\s*/, ''));\n                elizaLogger.debug(\"üìù Parsed technical details:\", {\n                    count: sections.technicalDetails.length\n                });\n            }\n\n            // Extract next steps\n            const nextStepsMatch = formattedEmail.match(/Next Steps:\\n([\\s\\S]*?)(?=\\n\\n|$)/);\n            sections.nextSteps = nextStepsMatch?.[1]\n                ?.split('\\n')\n                .filter(step => step.trim())\n                .map(step => step.trim().replace(/^(\\d+\\.|\\-|\\‚Ä¢)\\s*/, '')) || [];\n            elizaLogger.debug(\"üìù Parsed next steps:\", {\n                count: sections.nextSteps.length\n            });\n\n            // Validate required sections\n            if (!sections.subject || !sections.background || !sections.keyPoints.length) {\n                elizaLogger.warn(\"‚ö†Ô∏è Missing required sections:\", {\n                    hasSubject: !!sections.subject,\n                    hasBackground: !!sections.background,\n                    keyPointsCount: sections.keyPoints.length\n                });\n            }\n\n            return sections;\n        } catch (error) {\n            elizaLogger.error(\"‚ùå Error parsing email format:\", {\n                error: error instanceof Error ? error.message : String(error),\n                sections: Object.keys(sections)\n            });\n            throw new Error(`Failed to parse email format: ${error}`);\n        }\n    }\n\n    private formatUserIdentifier(userId: string): string {\n        // If userId is a Discord ID (typically a large number)\n        if (/^\\d{17,19}$/.test(userId)) {\n            return `Discord User ${userId}`;\n        }\n        // For email addresses\n        if (userId.includes('@')) {\n            return userId;\n        }\n        // Default format\n        return `User ${userId}`;\n    }\n\n    private detectPlatform(userId: string): string {\n        // Discord IDs are typically 17-19 digit numbers\n        if (/^\\d{17,19}$/.test(userId)) {\n            return 'discord';\n        }\n        // Email format\n        if (userId.includes('@')) {\n            return 'email';\n        }\n        // Default platform\n        return 'unknown';\n    }\n}\n","import { elizaLogger } from \"@elizaos/core\";\nimport { EmailTemplateManager } from \"./emailTemplateManager\";\nimport { ResendProvider } from \"../providers/resend\";\nimport {\n    EmailOptions,\n    EmailServiceOptions,\n    EmailProviderResponse,\n    GeneratedEmailContent,\n    EmailTemplate\n} from \"../types\";\n\nexport class EmailService {\n    private templateManager: EmailTemplateManager;\n    private provider: ResendProvider;\n\n    constructor(\n        private secrets: EmailServiceOptions,\n        templateManager?: EmailTemplateManager\n    ) {\n        elizaLogger.debug(\"Initializing EmailService\");\n        this.templateManager = templateManager || new EmailTemplateManager();\n        this.provider = new ResendProvider(this.secrets.RESEND_API_KEY);\n    }\n\n    async sendEmail(\n        content: GeneratedEmailContent,\n        options: Omit<EmailOptions, 'subject' | 'body' | 'html'>\n    ): Promise<EmailProviderResponse> {\n        elizaLogger.info(\"Starting email send process\", {\n            hasContent: !!content,\n            contentType: content ? typeof content : 'undefined',\n            templateManager: !!this.templateManager,\n            blocks: content.blocks\n        });\n\n        try {\n            const html = await this.templateManager.renderEmail(content);\n            const plainText = this.generatePlainText(content);\n\n            elizaLogger.debug(\"Template rendered\", {\n                hasHtml: !!html,\n                template: options.template || 'default',\n                htmlLength: html?.length || 0,\n                htmlPreview: html ? html.substring(0, 200) : 'No HTML generated'\n            });\n\n            elizaLogger.debug(\"Sending via Resend...\");\n            const response = await this.provider.sendEmail({\n                ...options,\n                from: options.from || this.secrets.OWNER_EMAIL || 'onboarding@resend.dev',\n                subject: content.subject,\n                body: plainText,\n                text: plainText,\n                html: html,\n                headers: {\n                    ...options.headers,\n                    'X-Template-ID': options.template || 'default',\n                    'X-Email-Priority': content.metadata.priority\n                },\n                tags: [\n                    ...(options.tags || []),\n                    { name: 'template', value: options.template || 'default' },\n                    { name: 'priority', value: content.metadata.priority }\n                ]\n            });\n            elizaLogger.debug(\"Resend API response:\", response);\n\n            return {\n                id: response.id,\n                provider: 'resend',\n                status: 'success',\n                timestamp: new Date()\n            };\n\n        } catch (error) {\n            elizaLogger.error(\"Failed to send email:\", {\n                error,\n                errorMessage: error instanceof Error ? error.message : String(error),\n                options: {\n                    to: options.to,\n                    subject: content.subject,\n                    blocksCount: content.blocks?.length\n                }\n            });\n            throw error;\n        }\n    }\n\n    private generatePlainText(content: GeneratedEmailContent): string {\n        const parts: string[] = [content.subject, ''];\n\n        content.blocks.forEach(block => {\n            if (block.type === 'bulletList' && Array.isArray(block.content)) {\n                parts.push(block.content.map(item => `‚Ä¢ ${item}`).join('\\n'));\n            } else if (block.type === 'heading') {\n                parts.push(`\\n${typeof block.content === 'string' ? block.content.toUpperCase() : ''}\\n`);\n            } else {\n                parts.push(block.content.toString());\n            }\n            parts.push(''); // Add spacing between blocks\n        });\n\n        return parts.join('\\n');\n    }\n}","import { EmailTemplate, EmailBlock, GeneratedEmailContent } from '../types';\nimport Handlebars from 'handlebars';\nimport { emailFormatTemplate } from '../templates/emailFormat';\n\nexport class EmailTemplateManager {\n    private templates: Map<string, EmailTemplate> = new Map();\n\n    constructor() {\n        this.registerDefaultTemplates();\n        this.registerHelpers();\n        // Register Handlebars helpers if needed\n        Handlebars.registerHelper('formatBlock', (block) => {\n            return new Handlebars.SafeString(this.formatBlock(block));\n        });\n    }\n\n    private registerDefaultTemplates() {\n        this.templates.set('default', {\n            id: 'default',\n            name: 'Default Template',\n            html: this.getDefaultTemplate(),\n            variables: ['subject', 'blocks', 'signature'],\n            defaultStyle: {\n                container: this.getDefaultStyles(),\n                notification: ''\n            }\n        });\n\n        this.templates.set('notification', {\n            id: 'notification',\n            name: 'Notification Template',\n            html: this.getNotificationTemplate(),\n            variables: ['subject', 'blocks', 'signature', 'priority'],\n            defaultStyle: {\n                container: this.getDefaultStyles(),\n                notification: this.getNotificationStyles()\n            }\n        });\n\n        // Register email format template\n        this.templates.set('format', {\n            id: 'format',\n            name: 'Email Format Template',\n            html: this.getEmailFormatTemplate(),\n            variables: ['memory', 'previousMessages'],\n            defaultStyle: {\n                container: this.getDefaultStyles(),\n                notification: ''\n            }\n        });\n    }\n\n    private registerHelpers() {\n        // Add the eq helper\n        Handlebars.registerHelper('eq', function(arg1: any, arg2: any) {\n            return arg1 === arg2;\n        });\n\n        // Existing helpers\n        Handlebars.registerHelper('formatBlock', (block: EmailBlock) => {\n            switch (block.type) {\n                case 'paragraph':\n                    return new Handlebars.SafeString(\n                        `<p class=\"email-paragraph ${block.metadata?.className || ''}\"\n                            style=\"${block.metadata?.style || ''}\">${block.content}</p>`\n                    );\n                case 'bulletList':\n                    return new Handlebars.SafeString(\n                        `<ul class=\"email-list ${block.metadata?.className || ''}\"\n                            style=\"${block.metadata?.style || ''}\">\n                            ${Array.isArray(block.content)\n                                ? block.content.map(item =>\n                                    `<li class=\"email-list-item\">${item}</li>`).join('')\n                                : `<li class=\"email-list-item\">${block.content}</li>`}\n                        </ul>`\n                    );\n                case 'heading':\n                    return new Handlebars.SafeString(\n                        `<h2 class=\"email-heading ${block.metadata?.className || ''}\"\n                            style=\"${block.metadata?.style || ''}\">${block.content}</h2>`\n                    );\n                case 'signature':\n                    return new Handlebars.SafeString(\n                        `<div class=\"email-signature\">${block.content}</div>`\n                    );\n                case 'callout':\n                    return new Handlebars.SafeString(\n                        `<div class=\"email-callout ${block.metadata?.className || ''}\"\n                            style=\"${block.metadata?.style || ''}\">${block.content}</div>`\n                    );\n                default:\n                    return block.content;\n            }\n        });\n\n        // Existing priority badge helper\n        Handlebars.registerHelper('priorityBadge', (priority: string) => {\n            const colors = {\n                high: '#dc3545',\n                medium: '#ffc107',\n                low: '#28a745'\n            };\n            return new Handlebars.SafeString(\n                `<div class=\"priority-badge\"\n                    style=\"background-color: ${colors[priority as keyof typeof colors]}\">\n                    ${priority.toUpperCase()}\n                </div>`\n            );\n        });\n\n        // Add currentYear helper\n        Handlebars.registerHelper('currentYear', function() {\n            return new Date().getFullYear();\n        });\n    }\n\n    getTemplate(templateId: string): EmailTemplate {\n        const template = this.templates.get(templateId);\n        if (!template) {\n            return this.templates.get('default')!;\n        }\n        return template;\n    }\n\n    registerTemplate(template: EmailTemplate): void {\n        this.validateTemplate(template);\n        this.templates.set(template.id, template);\n    }\n\n    private getDefaultTemplate(): string {\n        return `\n            <!DOCTYPE html>\n            <html>\n                <head>\n                    <meta charset=\"utf-8\">\n                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n                    <title>{{subject}}</title>\n                    <style>\n                        {{{defaultStyle}}}\n                    </style>\n                </head>\n                <body>\n                    <div class=\"email-container\">\n                        <div class=\"banner\" style=\"\n                            background-color: #f8f9fa;\n                            padding: 12px;\n                            text-align: center;\n                            border-bottom: 1px solid #e9ecef;\n                        \">\n                            <div style=\"\n                                display: inline-flex;\n                                align-items: center;\n                                gap: 8px;\n                                color: #6c757d;\n                                font-size: 13px;\n                            \">\n                                <img\n                                    src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAA7AAAAOwBeShxvQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAMGSURBVFiF7ZdNiFZVGMd/z7lvM42WYR8GZkIxFhFR0SaIIYKoFrWQClpUq4jIjRAtWkWLNkEtoke3LiIiEmoVFBW0KKgQIgxCsKgPqEbMJnScyY9m3vt/WtxzZ+68H3PvO4vEH1zOc59zzvM/z3Oe8zznXuv1eqaqqmeBy4ClwGXApcB8YB4wC+gBCmAM+Bv4DTgGHAEOA4eAn4HjwIRz7lSz2SyMMTNZa7uAjcBDwB3A7LbhE8BPwEHgG2Af8BVwyvf9KedcL4Ax5gygH7gXWA/cBMw5g4EW8D3wMfAR8I1zbqIoCq8sy24gAh4G1gGzz9LwdOSBz4G3gY+dc+PGmPnAvcDjwMozjP0H+ALYB+wGDgHHgFNAE6iBi4ErgGuAQWAlsKhj/jjwLvC6c+5PY0wPMAQ8CawBvG7GgO+AncBOY8xeYMJaW5dlmTfGzAZuBe4H7gYub5s7CmwD3nLOjRpj5gKPAE8By9rm/QXsALYbY/YAjTzPTdd13XVd13med4Ux5lHgAWBh29yvgNeAHc65MQBjzELgceBp4MK2ed8C24wxO40xR+u6bvi+71dVVRRFUQRBEBhjFhtjHgQeBZYBPnAS2A1sNcZ86ZzLjTEXAE8AzwAXt637KLAd2GaM+b0oCr+u6zzP86ooikZZlkEQBHPSNN0ErAUuAQLgb+BzYKsx5rM0TcuttQ8BzwOL29b7AdgKvJ+m6bEkSYKqqvI8z6uyLJtlWQZ1XTfSNL0OeBFYDVyQJv8L/Ai8A7yXJMnBOI5XAy8AK9rW+RN4B3grSZL9URTNqaoqz/O8KsuylabpnLquG1VVNcqybBRFERRF4fu+PwDcDNwOrAKWkO6AY8CPwF5gD/CVtfZEkiRrgOeBwbb1jwPvA28mSfJ1FEWzgQZAXddlURRBXdeNoigC3/d9z/M8Y0xXmqaLgaVpmi5N03RxmqYL0jSdl6bprDRNZ6ZpGqRp6qdp6qVpijFm0hhzMk3TkTRNj6Vp+keapofTND2QpumPxpijxpimMcY45wqALMv+A2qXz6gxuUEjAAAAAElFTkSuQmCC\"\n                                    alt=\"ElizaOS\"\n                                    style=\"width: 14px; height: 14px;\"\n                                >\n                                Powered by ElizaOS\n                            </div>\n                        </div>\n                        <div class=\"content\">\n                            <h1>{{subject}}</h1>\n                            {{#each blocks}}\n                                {{{formatBlock this}}}\n                            {{/each}}\n                        </div>\n                    </div>\n                </body>\n            </html>\n        `.trim();\n    }\n\n    private getNotificationTemplate(): string {\n        return `\n            <!DOCTYPE html>\n            <html>\n                <head>\n                    <meta charset=\"utf-8\">\n                    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n                    <style>{{{defaultStyle}}}</style>\n                </head>\n                <body>\n                    <div class=\"email-container notification\">\n                        <div class=\"notification-header\">\n                            <h1 class=\"email-subject\">{{subject}}</h1>\n                            {{#if metadata.showPriority}}\n                                {{#if metadata.priority}}\n                                    {{priorityBadge metadata.priority}}\n                                {{/if}}\n                            {{/if}}\n                        </div>\n                        {{#each blocks}}\n                            {{formatBlock this}}\n                        {{/each}}\n                        {{#if signature}}\n                            <div class=\"email-signature\">{{{signature}}}</div>\n                        {{/if}}\n                        <div class=\"footer\">\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                <path d=\"M12 2L2 7L12 12L22 7L12 2Z\" stroke=\"#6c757d\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                                <path d=\"M2 17L12 22L22 17\" stroke=\"#6c757d\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                                <path d=\"M2 12L12 17L22 12\" stroke=\"#6c757d\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                            </svg>\n                            Powered by ElizaOS\n                        </div>\n                    </div>\n                </body>\n            </html>\n        `;\n    }\n\n    public getDefaultStyles(): string {\n        return `\n            /* Reset styles */\n            body, html {\n                margin: 0;\n                padding: 0;\n                width: 100%;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                line-height: 1.6;\n                color: #333333;\n                background-color: #f6f9fc;\n            }\n\n            /* Container */\n            .email-container {\n                max-width: 600px;\n                margin: 20px auto;\n                background-color: #ffffff;\n                border-radius: 8px;\n                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n                overflow: hidden;\n            }\n\n            /* Header */\n            .header {\n                text-align: center;\n                padding: 24px;\n                background-color: #f8f9fa;\n            }\n\n            .logo {\n                height: 12px;\n                width: 12px;\n                margin: 12px;\n                object-fit: contain;\n            }\n\n            /* Content */\n            .content {\n                padding: 32px 24px;\n                background-color: #ffffff;\n            }\n\n            /* Typography */\n            h1 {\n                color: #2c3e50;\n                font-size: 24px;\n                font-weight: 600;\n                margin: 0 0 24px;\n                padding-bottom: 16px;\n                border-bottom: 1px solid #eaeaea;\n            }\n\n            .email-paragraph {\n                margin: 0 0 20px;\n                color: #2c3e50;\n            }\n\n            .email-list {\n                margin: 20px 0;\n                padding-left: 20px;\n            }\n\n            .email-list-item {\n                margin: 8px 0;\n            }\n\n            .signature {\n                margin-top: 30px;\n                padding-top: 20px;\n                border-top: 1px solid #eaeaea;\n                font-style: italic;\n                color: #666;\n            }\n\n            /* Footer */\n            .footer-divider {\n                height: 1px;\n                background-color: #eaeaea;\n                margin: 0;\n            }\n\n            .footer {\n                padding: 16px;\n                text-align: center;\n                background-color: #f8f9fa;\n                color: #6b7280;\n            }\n\n            .footer-text {\n                font-size: 14px;\n                display: block;\n                margin-bottom: 8px;\n            }\n\n            .copyright {\n                font-size: 12px;\n                color: #9ca3af;\n            }\n\n            .powered-by {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n                margin: 12px 0;\n            }\n\n            .eliza-icon {\n                opacity: 0.8;\n            }\n\n            .footer-links {\n                margin-top: 12px;\n            }\n\n            .footer-links a {\n                color: #666666;\n                text-decoration: none;\n                transition: color 0.15s ease;\n            }\n\n            .footer-links a:hover {\n                color: #333333;\n            }\n\n            /* Responsive */\n            @media only screen and (max-width: 640px) {\n                .email-container {\n                    margin: 0;\n                    border-radius: 0;\n                }\n\n                .content {\n                    padding: 24px 20px;\n                }\n            }\n\n            .powered-link {\n                color: #6b7280;\n                text-decoration: none;\n                transition: color 0.15s ease;\n            }\n\n            .powered-link:hover {\n                color: #374151;\n            }\n\n            .default-logo {\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                padding: 16px 0;\n                background: #f8f9fa;\n            }\n\n            .default-logo svg {\n                height: 48px;\n                width: 48px;\n                color: #2c3e50;\n            }\n\n            /* Dark mode support */\n            @media (prefers-color-scheme: dark) {\n                .default-logo svg {\n                    color: #f8f9fa;\n                }\n            }\n\n            .copyright {\n                text-align: center;\n                padding: 16px;\n                color: #6b7280;\n                font-size: 12px;\n                border-top: 1px solid #eaeaea;\n            }\n\n            .footer {\n                text-align: center;\n                padding: 12px;\n                background-color: #f8f9fa;\n                color: #6b7280;\n                font-size: 13px;\n                border-top: 1px solid #eaeaea;\n            }\n\n            .paragraph {\n                color: #374151;\n                margin: 16px 0;\n                line-height: 1.6;\n            }\n\n            .bullet-list {\n                margin: 16px 0;\n                padding-left: 24px;\n            }\n\n            .bullet-list li {\n                color: #374151;\n                margin: 8px 0;\n                line-height: 1.5;\n            }\n\n            .heading {\n                color: #111827;\n                font-size: 20px;\n                font-weight: 600;\n                margin: 24px 0 16px 0;\n            }\n\n            .signature {\n                margin: 32px 0 24px;\n                color: #4B5563;\n                font-style: italic;\n            }\n        `.trim();\n    }\n\n    private getNotificationStyles(): string {\n        return `\n            ${this.getDefaultStyles()}\n            .notification {\n                border: 1px solid #e1e4e8;\n                border-radius: 6px;\n                box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n            }\n            .notification-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                margin-bottom: 24px;\n            }\n            .priority-badge {\n                display: inline-block;\n                padding: 4px 8px;\n                border-radius: 12px;\n                color: white;\n                font-size: 12px;\n                font-weight: 500;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n            }\n            .notification .email-paragraph {\n                background: #f8f9fa;\n                padding: 16px;\n                border-radius: 4px;\n                margin: 12px 0;\n            }\n            .notification .email-list {\n                background: #f8f9fa;\n                padding: 16px 16px 16px 36px;\n                border-radius: 4px;\n                margin: 12px 0;\n            }\n        `;\n    }\n\n    async renderEmail(content: GeneratedEmailContent): Promise<string> {\n        try {\n            const template = this.getTemplate(content.metadata.priority === 'high' ? 'notification' : 'default');\n            const compiledTemplate = Handlebars.compile(template.html);\n\n            const rendered = compiledTemplate({\n                subject: content.subject,\n                blocks: content.blocks,\n                metadata: content.metadata,\n                defaultStyle: this.getDefaultStyles()\n            });\n\n            return rendered;\n        } catch (error) {\n            console.error('Template rendering error:', error);\n            throw error;\n        }\n    }\n\n    renderBlock(block: EmailBlock): string {\n        switch (block.type) {\n            case 'paragraph':\n                return `<p class=\"email-paragraph\">${block.content}</p>`;\n            case 'bulletList':\n                const items = Array.isArray(block.content)\n                    ? block.content\n                    : [block.content];\n                return `\n                    <ul class=\"email-list\">\n                        ${items.map(item => `<li>${item}</li>`).join('\\n')}\n                    </ul>\n                `;\n            case 'heading':\n                return `<h2 class=\"email-heading\">${block.content}</h2>`;\n            default:\n                return String(block.content);\n        }\n    }\n\n    private formatBlock(block: EmailBlock): string {\n        switch (block.type) {\n            case 'paragraph':\n                return `<p class=\"paragraph\">${block.content}</p>`;\n            case 'bulletList':\n                if (!block.content) return ''; // Ensure content is available\n                const items = Array.isArray(block.content) ? block.content : [block.content];\n                return `<ul class=\"bullet-list\">\n                    ${items.map((item: string) => `<li>${item}</li>`).join('\\n')}\n                </ul>`;\n            case 'heading':\n                return `<h2 class=\"heading\">${block.content}</h2>`;\n            default:\n                return String(block.content || ''); // Ensure a string is always returned\n        }\n    }\n\n    private getEmailFormatTemplate(): string {\n        return emailFormatTemplate;\n    }\n\n    private validateTemplate(template: EmailTemplate): void {\n        if (!template.id || !template.html || !template.variables) {\n            throw new Error(\n                'Invalid template: missing required fields (id, html, variables)'\n            );\n        }\n\n        // Validate HTML structure\n        if (!template.html.includes('{{content}}') &&\n            !template.html.includes('{{blocks}}')) {\n            throw new Error(\n                'Invalid template: missing required content placeholder'\n            );\n        }\n    }\n}","export const emailFormatTemplate = `\n<context>\n# Conversation Details\nUser ID: {{memory.userId}}\nName: {{memory.senderName}}\nBio: {{memory.bio}}\nRecent Messages: {{previousMessages}}\n</context>\n\n<evaluation_steps>\n1. Extract Key Quotes:\n‚Ä¢ Pull exact phrases about role/company\n‚Ä¢ Identify specific technical claims\n‚Ä¢ Note any metrics or numbers\n‚Ä¢ Capture stated intentions\n\n2. Extract Core Information:\n‚Ä¢ Professional context\n‚Ä¢ Technical details\n‚Ä¢ Project specifics\n‚Ä¢ Team background\n\n3. Organize Key Points:\n‚Ä¢ Identify main value propositions\n‚Ä¢ Extract concrete metrics/details\n‚Ä¢ Note specific technical requirements\n‚Ä¢ Highlight relevant experience\n\n4. Plan Next Steps:\n‚Ä¢ Consider conversation stage\n‚Ä¢ Identify information gaps\n‚Ä¢ Determine appropriate follow-up\n‚Ä¢ Set clear action items\n</evaluation_steps>\n\n<instructions>\nFirst, extract the most relevant quotes from the conversation that should be included in the email. Put them in <relevant_quotes> tags.\n\nThen, format an email summary using EXACTLY this format:\n\n<email_format>\nSubject: [Clear, specific title with role/company]\n\nBackground:\n[2-3 sentences about who they are and relevant context, based on extracted quotes]\n\nKey Points:\n‚Ä¢ [3-5 bullet points about their main interests/proposals, supported by quotes]\n\nTechnical Details:\n‚Ä¢ [Technical detail 1 if available]\n‚Ä¢ [Technical detail 2 if available]\n\nNext Steps:\n1. [First action item]\n2. [Second action item]\n</email_format>\nOutput the email in this exact format, omitting sections if insufficient information exists. Only include information that can be supported by the extracted quotes.\n</instructions>\n\n<final_thought>\nRemember: Be concise and factual. Focus on actionable information over general statements. Do not include details that aren't supported by extracted quotes.\n</final_thought>\n`;\n\n","import { Resend } from \"resend\";\nimport { elizaLogger } from \"@elizaos/core\";\nimport type {\n    EmailOptions,\n    EmailResponse,\n    EmailProviderError,\n    EmailProviderResponse\n} from \"../types\";\nimport { createEmailProviderError } from './errors';\n\nexport class ResendProvider {\n    private client: Resend;\n    private readonly retryAttempts = 3;\n    private readonly retryDelay = 1000; // ms\n\n    constructor(apiKey: string) {\n        this.client = new Resend(apiKey);\n    }\n\n    async sendEmail(options: EmailOptions): Promise<EmailProviderResponse> {\n        let lastError: Error | null = null;\n\n        for (let attempt = 1; attempt <= this.retryAttempts; attempt++) {\n            try {\n                const response = await this.client.emails.send({\n                    from: options.from,\n                    to: options.to,\n                    subject: options.subject,\n                    html: options.html || options.body,\n                    text: options.text,\n                    bcc: options.bcc,\n                    cc: options.cc,\n                    reply_to: options.replyTo,\n                    headers: options.headers,\n                    attachments: options.attachments,\n                    tags: options.tags\n                });\n\n                if (!response.data?.id) {\n                    throw new Error('Missing response data from Resend');\n                }\n\n                elizaLogger.debug('Email sent successfully', {\n                    id: response.data.id,\n                    attempt\n                });\n\n                return {\n                    id: response.data.id,\n                    provider: 'resend',\n                    status: 'success',\n                    timestamp: new Date()\n                };\n\n            } catch (error) {\n                lastError = error as Error;\n                elizaLogger.error(`Resend attempt ${attempt} failed:`, {\n                    error,\n                    options: {\n                        to: options.to,\n                        subject: options.subject\n                    }\n                });\n\n                if (this.shouldRetry(error) && attempt < this.retryAttempts) {\n                    await this.delay(attempt * this.retryDelay);\n                    continue;\n                }\n                break;\n            }\n        }\n\n        throw createEmailProviderError(\n            'resend',\n            lastError as Error,\n            {\n                attempts: this.retryAttempts,\n                lastAttemptAt: new Date().toISOString()\n            }\n        );\n    }\n\n    private shouldRetry(error: unknown): boolean {\n        if (error instanceof Error) {\n            // Retry on network errors or rate limits\n            return error.message.includes('network') ||\n                   error.message.includes('rate limit') ||\n                   error.message.includes('timeout');\n        }\n        return false;\n    }\n\n    private delay(ms: number): Promise<void> {\n        return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n    async validateConfig(): Promise<boolean> {\n        try {\n            // Try to get account info or similar lightweight call\n            await this.client.emails.send({\n                from: 'test@resend.dev',\n                to: 'validate@resend.dev',\n                subject: 'Configuration Test',\n                text: 'Testing configuration'\n            });\n            return true;\n        } catch (error) {\n            if (error instanceof Error &&\n                error.message.includes('unauthorized')) {\n                return false;\n            }\n            // Other errors might indicate valid config but other issues\n            return true;\n        }\n    }\n}","export class EmailProviderError extends Error {\n    constructor(\n        public provider: string,\n        public originalError: unknown,\n        public context?: Record<string, unknown>\n    ) {\n        super(`Error in ${provider} provider: ${originalError}`);\n        this.name = 'EmailProviderError';\n    }\n}\n\n// Export the factory function\nexport const createEmailProviderError = (\n    provider: string,\n    error: unknown,\n    context?: Record<string, unknown>\n): EmailProviderError => new EmailProviderError(provider, error, context);","export const shouldEmailTemplate = `\n<context>\n# Current Conversation\nMessage: {{message.content.text}}\nPrevious Context: {{previousMessages}}\n\n# Agent Context\nName: {{agentName}}\nBackground: {{bio}}\nKey Interests: {{topics}}\n</context>\n\n<evaluation_steps>\n1. Extract Key Quotes:\n‚Ä¢ Pull exact phrases about role/company\n‚Ä¢ Identify specific technical claims\n‚Ä¢ Note any metrics or numbers\n‚Ä¢ Capture stated intentions\n\n2. Assess Information Quality:\n‚Ä¢ Verify professional context\n‚Ä¢ Check for technical specifics\n‚Ä¢ Look for concrete project details\n‚Ä¢ Confirm decision-making authority\n\n3. Evaluate Readiness:\n‚Ä¢ Sufficient context present\n‚Ä¢ Actionable information shared\n‚Ä¢ Appropriate timing for email\n‚Ä¢ Clear follow-up potential\n\n4. Check Partnership Signals:\n‚Ä¢ Explicit collaboration interest\n‚Ä¢ Technical capability alignment\n‚Ä¢ Resource commitment signals\n</evaluation_steps>\n\n<instructions>\nFirst, extract the most relevant quotes from the message that indicate email readiness. Put them in <relevant_quotes> tags.\n\nThen, analyze the quotes to determine if an email should be sent.\n\nRespond in this format:\n[EMAIL] - This warrants sending an email because <one sentence reason>\n[SKIP] - This does not warrant an email\n\nOnly base your decision on information explicitly present in the extracted quotes. Do not make assumptions or infer details not directly quoted.\n</instructions>\n\nRemember: Quality of information over speed of engagement. Never assume details that aren't explicitly quoted.\n`;","import { EmailAutomationService } from \"./services/emailAutomationService\";\n\nconst emailAutomationPlugin = {\n    name: \"email-automation\",\n    description: \"AI-powered email automation plugin for Eliza\",\n    services: [new EmailAutomationService() as any],\n    clients: [],\n    evaluators: [],\n    providers: [],\n};\n\nexport default emailAutomationPlugin;\n"],"mappings":"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","names":["elizaLogger","elizaLogger","elizaLogger","elizaLogger"]}